{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from \"express\";\nimport { verify } from \"jsonwebtoken\";\nimport { SECRET_KEY } from \"@config\";\nimport { DB } from \"@database\";\nimport { HttpException } from \"@/exceptions/httpException\";\nimport { DataStoredInToken, RequestWithUser } from \"@interfaces/auth.interface\";\n\nconst getAuthorization = (req) => {\n  const coockie = req.cookies[\"Authorization\"];\n  if (coockie) return coockie;\n\n  const header = req.header(\"Authorization\");\n  if (header) return header.split(\"Bearer \")[1];\n\n  return null;\n};\n\nexport const AuthMiddleware = async (\n  req: RequestWithUser,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    const Authorization = getAuthorization(req);\n\n    if (Authorization) {\n      const { id } = verify(Authorization, SECRET_KEY) as DataStoredInToken;\n      const findUser = await DB.Users.findByPk(id);\n\n      if (findUser) {\n        req.user = findUser;\n        next();\n      } else {\n        next(new HttpException(401, \"Wrong authentication token\"));\n      }\n    } else {\n      next(new HttpException(404, \"Authentication token missing\"));\n    }\n  } catch (error) {\n    next(new HttpException(401, \"Wrong authentication token\"));\n  }\n};\n"],"names":["AuthMiddleware","getAuthorization","req","coockie","cookies","header","split","res","next","Authorization","id","verify","SECRET_KEY","findUser","DB","Users","findByPk","user","HttpException","error"],"mappings":";;;;+BAiBaA;;;eAAAA;;;8BAhBU;wBACI;0BACR;+BACW;AAG9B,MAAMC,mBAAmB,CAACC;IACxB,MAAMC,UAAUD,IAAIE,OAAO,CAAC,gBAAgB;IAC5C,IAAID,SAAS,OAAOA;IAEpB,MAAME,SAASH,IAAIG,MAAM,CAAC;IAC1B,IAAIA,QAAQ,OAAOA,OAAOC,KAAK,CAAC,UAAU,CAAC,EAAE;IAE7C,OAAO;AACT;AAEO,MAAMN,iBAAiB,OAC5BE,KACAK,KACAC;IAEA,IAAI;QACF,MAAMC,gBAAgBR,iBAAiBC;QAEvC,IAAIO,eAAe;YACjB,MAAM,EAAEC,EAAE,EAAE,GAAGC,IAAAA,oBAAM,EAACF,eAAeG,kBAAU;YAC/C,MAAMC,WAAW,MAAMC,YAAE,CAACC,KAAK,CAACC,QAAQ,CAACN;YAEzC,IAAIG,UAAU;gBACZX,IAAIe,IAAI,GAAGJ;gBACXL;YACF,OAAO;gBACLA,KAAK,IAAIU,4BAAa,CAAC,KAAK;YAC9B;QACF,OAAO;YACLV,KAAK,IAAIU,4BAAa,CAAC,KAAK;QAC9B;IACF,EAAE,OAAOC,OAAO;QACdX,KAAK,IAAIU,4BAAa,CAAC,KAAK;IAC9B;AACF"}