{"version":3,"sources":["../../src/middlewares/validation.middleware.ts"],"sourcesContent":["import { plainToInstance } from \"class-transformer\";\nimport { validateOrReject, ValidationError } from \"class-validator\";\nimport { NextFunction, Request, Response } from \"express\";\nimport { HttpException } from \"@/exceptions/httpException\";\n\n/**\n * @name ValidationMiddleware\n * @description Allows use of decorator and non-decorator based validation\n * @param type dto\n * @param skipMissingProperties When skipping missing properties\n * @param whitelist Even if your object is an instance of a validation class it can contain additional properties that are not defined\n * @param forbidNonWhitelisted If you would rather to have an error thrown when any non-whitelisted properties are present\n */\nexport const ValidationMiddleware = (\n  type: any,\n  skipMissingProperties = false,\n  whitelist = false,\n  forbidNonWhitelisted = false\n) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const dto = plainToInstance(type, req.body);\n    validateOrReject(dto, {\n      skipMissingProperties,\n      whitelist,\n      forbidNonWhitelisted,\n    })\n      .then(() => {\n        req.body = dto;\n        next();\n      })\n      .catch((errors: ValidationError[]) => {\n        const message = errors\n          .map((error: ValidationError) => Object.values(error.constraints))\n          .join(\", \");\n        next(new HttpException(400, message));\n      });\n  };\n};\n"],"names":["ValidationMiddleware","type","skipMissingProperties","whitelist","forbidNonWhitelisted","req","res","next","dto","plainToInstance","body","validateOrReject","then","catch","errors","message","map","error","Object","values","constraints","join","HttpException"],"mappings":";;;;+BAaaA;;;eAAAA;;;kCAbmB;gCACkB;+BAEpB;AAUvB,MAAMA,uBAAuB,CAClCC,MACAC,wBAAwB,KAAK,EAC7BC,YAAY,KAAK,EACjBC,uBAAuB,KAAK;IAE5B,OAAO,CAACC,KAAcC,KAAeC;QACnC,MAAMC,MAAMC,IAAAA,iCAAe,EAACR,MAAMI,IAAIK,IAAI;QAC1CC,IAAAA,gCAAgB,EAACH,KAAK;YACpBN;YACAC;YACAC;QACF,GACGQ,IAAI,CAAC;YACJP,IAAIK,IAAI,GAAGF;YACXD;QACF,GACCM,KAAK,CAAC,CAACC;YACN,MAAMC,UAAUD,OACbE,GAAG,CAAC,CAACC,QAA2BC,OAAOC,MAAM,CAACF,MAAMG,WAAW,GAC/DC,IAAI,CAAC;YACRd,KAAK,IAAIe,4BAAa,CAAC,KAAKP;QAC9B;IACJ;AACF"}